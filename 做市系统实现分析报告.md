# æ•°å­—è´§å¸åšå¸‚ç³»ç»Ÿå®ç°åˆ†ææŠ¥å‘Š

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æ ¹æ®ã€Šæ•°å­—è´§å¸åšå¸‚ç³»ç»ŸæŠ€æœ¯æ–¹æ¡ˆ_1.mdã€‹ï¼Œå½“å‰QuantFlowé¡¹ç›®éœ€è¦ä»**é‡åŒ–äº¤æ˜“ç³»ç»Ÿ**å‡çº§ä¸º**åšå¸‚ç³»ç»Ÿ**ã€‚æœ¬æŠ¥å‘Šåˆ†æéœ€è¦å®ç°çš„æ ¸å¿ƒæ¨¡å—å’Œå®ç°è·¯å¾„ã€‚

---

## 1. å½“å‰é¡¹ç›®ç°çŠ¶åˆ†æ

### 1.1 å·²æœ‰åŸºç¡€èƒ½åŠ› âœ…

**å·²å®ç°æ¨¡å—**ï¼š
- âœ… äº¤æ˜“æ‰€é€‚é…å™¨æ¡†æ¶ï¼ˆBinanceå·²å®ç°ï¼ŒOKXå¾…å®ç°ï¼‰
- âœ… åŸºç¡€è®¢å•ç®¡ç†ï¼ˆä¸‹å•ã€æ’¤å•ã€æŸ¥è¯¢ï¼‰
- âœ… ç­–ç•¥å¼•æ“æ¡†æ¶ï¼ˆæ”¯æŒå¤šç§æŠ€æœ¯æŒ‡æ ‡ç­–ç•¥ï¼‰
- âœ… é£æ§ç³»ç»ŸåŸºç¡€æ¡†æ¶
- âœ… æŒä»“ç®¡ç†åŸºç¡€åŠŸèƒ½
- âœ… WebSocketæ¨é€æœåŠ¡
- âœ… è´¦æˆ·ç®¡ç†
- âœ… å›æµ‹ç³»ç»Ÿ

**æŠ€æœ¯æ ˆ**ï¼š
- Spring Boot 3.x + MyBatis-Plus
- MySQL 8.0 + Redis
- Vue 3å‰ç«¯
- åŸºç¡€WebSocketæ”¯æŒ

### 1.2 ç¼ºå¤±çš„æ ¸å¿ƒèƒ½åŠ› âŒ

**å…³é”®ç¼ºå¤±**ï¼š
1. âŒ **åšå¸‚ç­–ç•¥å¼•æ“**ï¼ˆå½“å‰åªæœ‰æŠ€æœ¯æŒ‡æ ‡ç­–ç•¥ï¼‰
2. âŒ **ç»Ÿä¸€æœ¬åœ°æ•°æ®ç®¡ç†å™¨**ï¼ˆLocalDataManagerï¼‰
3. âŒ **WebSocketå®æ—¶æ•°æ®æ¨é€**ï¼ˆè®¢å•ã€æŒä»“ã€ä½™é¢ã€ç›˜å£ï¼‰
4. âŒ **æ™ºèƒ½è®¢å•åˆ·æ–°æœºåˆ¶**ï¼ˆå¢é‡æ›´æ–°ã€é€‰æ‹©æ€§æ’¤å•ï¼‰
5. âŒ **ç›˜å£é•œåƒç­–ç•¥**
6. âŒ **åŒå‘æŒä»“ç®¡ç†**ï¼ˆåˆçº¦åšå¸‚ï¼‰
7. âŒ **åŠ¨æ€é…ç½®ç®¡ç†ç³»ç»Ÿ**
8. âŒ **æœ¬åœ°ç›˜å£ç»´æŠ¤æœºåˆ¶**

---

## 2. æ ¸å¿ƒæ¨¡å—å®ç°è§„åˆ’

### 2.1 æ¨¡å—ä¼˜å…ˆçº§åˆ’åˆ†

#### P0 - æ ¸å¿ƒåŸºç¡€æ¨¡å—ï¼ˆå¿…é¡»å®ç°ï¼‰

| æ¨¡å— | ä¼˜å…ˆçº§ | é¢„è®¡å·¥ä½œé‡ | ä¾èµ–å…³ç³» |
|-----|--------|-----------|---------|
| ç»Ÿä¸€æœ¬åœ°æ•°æ®ç®¡ç†å™¨ | P0 | 3-5å¤© | æ—  |
| WebSocketæ•°æ®æ¨é€ | P0 | 5-7å¤© | ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨ |
| æœ¬åœ°ç›˜å£ç»´æŠ¤ | P0 | 3-5å¤© | WebSocketæ¨é€ |
| åšå¸‚ç­–ç•¥å¼•æ“ | P0 | 5-7å¤© | æœ¬åœ°ç›˜å£ |
| æ™ºèƒ½è®¢å•åˆ·æ–° | P0 | 5-7å¤© | åšå¸‚ç­–ç•¥ |

#### P1 - é‡è¦åŠŸèƒ½æ¨¡å—ï¼ˆå»ºè®®å®ç°ï¼‰

| æ¨¡å— | ä¼˜å…ˆçº§ | é¢„è®¡å·¥ä½œé‡ | ä¾èµ–å…³ç³» |
|-----|--------|-----------|---------|
| åŒå‘æŒä»“ç®¡ç† | P1 | 3-5å¤© | ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨ |
| åŠ¨æ€é…ç½®ç®¡ç† | P1 | 5-7å¤© | æ—  |
| ç›˜å£é•œåƒç­–ç•¥ | P1 | 3-5å¤© | æœ¬åœ°ç›˜å£ |
| åˆ†å±‚åˆ·æ–°ç­–ç•¥ | P1 | 3-5å¤© | æ™ºèƒ½è®¢å•åˆ·æ–° |

#### P2 - ä¼˜åŒ–å¢å¼ºæ¨¡å—ï¼ˆå¯é€‰å®ç°ï¼‰

| æ¨¡å— | ä¼˜å…ˆçº§ | é¢„è®¡å·¥ä½œé‡ | ä¾èµ–å…³ç³» |
|-----|--------|-----------|---------|
| å¥—åˆ©é˜²æŠ¤ | P2 | 2-3å¤© | ç›˜å£é•œåƒ |
| è®¢å•åˆ·æ–°æ—¥å¿— | P2 | 2-3å¤© | æ™ºèƒ½è®¢å•åˆ·æ–° |
| é…ç½®ç®¡ç†Webç•Œé¢ | P2 | 5-7å¤© | åŠ¨æ€é…ç½®ç®¡ç† |

---

## 3. è¯¦ç»†å®ç°æ–¹æ¡ˆ

### 3.1 ç»Ÿä¸€æœ¬åœ°æ•°æ®ç®¡ç†å™¨ï¼ˆLocalDataManagerï¼‰â­

**ä½ç½®**ï¼š`quantflow-trading/src/main/java/com/quantflow/trading/data/`

**æ ¸å¿ƒèŒè´£**ï¼š
- ç»Ÿä¸€ç®¡ç†è®¢å•ã€æŒä»“ã€ä½™é¢ã€ç›˜å£æ•°æ®
- è‡ªåŠ¨åˆ¤æ–­æ•°æ®æ–°é²œåº¦
- è‡ªåŠ¨é™çº§åˆ°REST API
- æä¾›ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£

**éœ€è¦åˆ›å»ºçš„æ–‡ä»¶**ï¼š
```
data/
â”œâ”€â”€ LocalDataManager.java          # æ ¸å¿ƒç®¡ç†å™¨
â”œâ”€â”€ TimestampedData.java           # å¸¦æ—¶é—´æˆ³çš„æ•°æ®å®¹å™¨
â”œâ”€â”€ DataSource.java                 # æ•°æ®æ¥æºæšä¸¾
â””â”€â”€ DataConsistencyChecker.java    # æ•°æ®ä¸€è‡´æ€§æ ¡éªŒå™¨
```

**å…³é”®è®¾è®¡ç‚¹**ï¼š
1. ä½¿ç”¨`ConcurrentHashMap`å­˜å‚¨æ•°æ®ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨
2. æ¯ä¸ªæ•°æ®å¸¦æ—¶é—´æˆ³ï¼Œè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦è¿‡æœŸ
3. è¿‡æœŸé˜ˆå€¼ï¼š
   - è®¢å•ï¼š2ç§’
   - æŒä»“ï¼š5ç§’
   - ä½™é¢ï¼š10ç§’
   - ç›˜å£ï¼š1ç§’
4. WebSocketæ¨é€æ—¶è‡ªåŠ¨æ›´æ–°ç¼“å­˜
5. æŸ¥è¯¢æ—¶è‡ªåŠ¨é™çº§åˆ°REST API

**ä¸ç°æœ‰ä»£ç é›†æˆ**ï¼š
- æ›¿æ¢ç°æœ‰çš„è®¢å•æŸ¥è¯¢é€»è¾‘
- æ›¿æ¢ç°æœ‰çš„æŒä»“æŸ¥è¯¢é€»è¾‘
- æ›¿æ¢ç°æœ‰çš„ä½™é¢æŸ¥è¯¢é€»è¾‘

---

### 3.2 WebSocketæ•°æ®æ¨é€æ¨¡å—

**ä½ç½®**ï¼š`quantflow-trading/src/main/java/com/quantflow/trading/websocket/`

**éœ€è¦æ‰©å±•çš„åŠŸèƒ½**ï¼š

#### 3.2.1 åšå¸‚äº¤æ˜“æ‰€WebSocketè®¢é˜…

**æ–°å¢æ–‡ä»¶**ï¼š
```
websocket/
â”œâ”€â”€ exchange/
â”‚   â”œâ”€â”€ TradingWebSocketManager.java      # åšå¸‚äº¤æ˜“æ‰€WebSocketç®¡ç†
â”‚   â”œâ”€â”€ MarketDataWebSocketManager.java   # å‚è€ƒäº¤æ˜“æ‰€WebSocketç®¡ç†
â”‚   â””â”€â”€ WebSocketHealthMonitor.java      # WebSocketå¥åº·ç›‘æ§
â””â”€â”€ handler/
    â”œâ”€â”€ OrderUpdateHandler.java           # è®¢å•æ›´æ–°å¤„ç†å™¨
    â”œâ”€â”€ PositionUpdateHandler.java        # æŒä»“æ›´æ–°å¤„ç†å™¨
    â”œâ”€â”€ BalanceUpdateHandler.java         # ä½™é¢æ›´æ–°å¤„ç†å™¨
    â””â”€â”€ OrderBookUpdateHandler.java      # ç›˜å£æ›´æ–°å¤„ç†å™¨
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. **è®¢å•çŠ¶æ€æ¨é€**ï¼ˆå…³é”®ï¼‰
   - è®¢é˜…è®¢å•æ›´æ–°é¢‘é“
   - å®æ—¶æ¥æ”¶è®¢å•çŠ¶æ€å˜åŒ–ï¼ˆPENDING â†’ PARTIAL_FILLED â†’ FILLEDï¼‰
   - è‡ªåŠ¨æ›´æ–°LocalDataManager
   - è§¦å‘è¡¥å•é€»è¾‘

2. **æŒä»“å˜åŒ–æ¨é€**
   - è®¢é˜…æŒä»“æ›´æ–°é¢‘é“
   - å®æ—¶æ¥æ”¶æŒä»“å˜åŒ–
   - è§¦å‘é£æ§æ£€æŸ¥

3. **è´¦æˆ·ä½™é¢æ¨é€**
   - è®¢é˜…ä½™é¢æ›´æ–°é¢‘é“
   - å®æ—¶ç›‘æ§å¯ç”¨ä¿è¯é‡‘
   - è§¦å‘ä¿è¯é‡‘é¢„è­¦

4. **ç›˜å£æ·±åº¦æ¨é€**
   - è®¢é˜…ç›˜å£æ›´æ–°é¢‘é“
   - ç»´æŠ¤æœ¬åœ°ç›˜å£å¿«ç…§
   - æ”¯æŒå¢é‡æ›´æ–°

**ä¸ç°æœ‰ä»£ç é›†æˆ**ï¼š
- æ‰©å±•ç°æœ‰çš„`TradingWebSocketServer.java`
- é›†æˆåˆ°`LocalDataManager`

---

### 3.3 æœ¬åœ°ç›˜å£ç»´æŠ¤æœºåˆ¶

**ä½ç½®**ï¼š`quantflow-trading/src/main/java/com/quantflow/trading/market/orderbook/`

**éœ€è¦åˆ›å»ºçš„æ–‡ä»¶**ï¼š
```
market/orderbook/
â”œâ”€â”€ LocalOrderBookManager.java           # æœ¬åœ°ç›˜å£ç®¡ç†å™¨
â”œâ”€â”€ OrderBookSnapshot.java                # ç›˜å£å¿«ç…§æ•°æ®ç»“æ„
â”œâ”€â”€ PriceLevel.java                       # ä»·æ ¼æ¡£ä½
â”œâ”€â”€ OrderBookWebSocketManager.java       # ç›˜å£WebSocketç®¡ç†
â”œâ”€â”€ OrderBookInitializer.java            # ç›˜å£åˆå§‹åŒ–å™¨
â””â”€â”€ OrderBookHealthMonitor.java          # ç›˜å£å¥åº·ç›‘æ§
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. **å†…å­˜ç›˜å£å¿«ç…§**
   - ä½¿ç”¨`volatile + CopyOnWrite`ä¿è¯çº¿ç¨‹å®‰å…¨
   - æ”¯æŒå¿«é€ŸæŸ¥è¯¢ï¼ˆ<0.1msï¼‰
   - è‡ªåŠ¨æ£€æµ‹æ•°æ®è¿‡æœŸ

2. **åˆå§‹åŒ–æµç¨‹**
   - REST APIè·å–åˆå§‹å¿«ç…§ï¼ˆ20æ¡£æ·±åº¦ï¼‰
   - å»ºç«‹WebSocketè¿æ¥
   - æ¥æ”¶å¢é‡æ›´æ–°

3. **Redisç¼“å­˜**
   - è·¨èŠ‚ç‚¹å…±äº«ç›˜å£æ•°æ®
   - 5ç§’è¿‡æœŸæ—¶é—´
   - ä½¿ç”¨Luaè„šæœ¬åŸå­æ›´æ–°

**ä¸ç°æœ‰ä»£ç é›†æˆ**ï¼š
- æ›¿æ¢ç°æœ‰çš„`MarketDataService`ä¸­çš„ç›˜å£æŸ¥è¯¢é€»è¾‘
- é›†æˆåˆ°`LocalDataManager`

---

### 3.4 åšå¸‚ç­–ç•¥å¼•æ“

**ä½ç½®**ï¼š`quantflow-trading/src/main/java/com/quantflow/trading/strategy/marketmaking/`

**éœ€è¦åˆ›å»ºçš„æ–‡ä»¶**ï¼š
```
strategy/marketmaking/
â”œâ”€â”€ MarketMakingStrategy.java            # åšå¸‚ç­–ç•¥åŸºç±»
â”œâ”€â”€ MirrorStrategy.java                  # ç›˜å£é•œåƒç­–ç•¥
â”œâ”€â”€ ClassicMarketMakingStrategy.java    # ç»å…¸åšå¸‚ç­–ç•¥
â”œâ”€â”€ OrderRefreshService.java            # è®¢å•åˆ·æ–°æœåŠ¡
â”œâ”€â”€ OrderPositionChecker.java           # è®¢å•ä½ç½®æ£€æŸ¥å™¨
â””â”€â”€ StrictFollowingStrategy.java       # ä¸¥æ ¼è·Ÿéšç­–ç•¥
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

#### 3.4.1 ç›˜å£é•œåƒç­–ç•¥ï¼ˆMirrorStrategyï¼‰

**ç­–ç•¥é€»è¾‘**ï¼š
```java
1. è·å–å‚è€ƒäº¤æ˜“æ‰€ï¼ˆBinanceï¼‰ç›˜å£
2. è®¡ç®—ç›®æ ‡ä»·æ ¼ï¼ˆå‚è€ƒä»·æ ¼ + åç§»ï¼‰
3. è®¡ç®—ç›®æ ‡æ•°é‡ï¼ˆå‚è€ƒæ•°é‡ Ã— æ¯”ä¾‹ï¼‰
4. ç”Ÿæˆè®¢å•åˆ—è¡¨
5. è°ƒç”¨æ™ºèƒ½è®¢å•åˆ·æ–°æœåŠ¡
```

**å…³é”®å‚æ•°**ï¼š
- `referenceExchange`: å‚è€ƒäº¤æ˜“æ‰€ï¼ˆBinanceï¼‰
- `targetExchange`: åšå¸‚äº¤æ˜“æ‰€
- `priceAdjustment`: ä»·æ ¼è°ƒæ•´ï¼ˆå¦‚+0.05%ï¼‰
- `volumeRatio`: æ•°é‡æ¯”ä¾‹ï¼ˆå¦‚30%ï¼‰
- `depthLevels`: æ·±åº¦å±‚çº§ï¼ˆå¦‚10æ¡£ï¼‰
- `strictFollowLevels`: ä¸¥æ ¼è·Ÿéšæ¡£ä½ï¼ˆå¦‚å‰5æ¡£ï¼‰

#### 3.4.2 æ™ºèƒ½è®¢å•åˆ·æ–°æœºåˆ¶

**åˆ·æ–°ç­–ç•¥**ï¼š
1. **å¢é‡åˆ·æ–°**ï¼šåªè°ƒæ•´éœ€è¦å˜æ›´çš„è®¢å•
2. **é€‰æ‹©æ€§æ’¤å•**ï¼šåªæ’¤é”€ä»·æ ¼åç¦»è¾ƒå¤§çš„è®¢å•
3. **æ™ºèƒ½è¡¥å•**ï¼šéƒ¨åˆ†æˆäº¤åè‡ªåŠ¨è¡¥å•
4. **æ‰¹é‡æ“ä½œ**ï¼šæ‰¹é‡æ’¤å•ã€æ‰¹é‡ä¸‹å•

**åˆ·æ–°è§¦å‘æ¡ä»¶**ï¼š
- ä»·æ ¼å˜åŒ–è¶…è¿‡é˜ˆå€¼
- è®¢å•æˆäº¤
- å®šæ—¶åˆ·æ–°ï¼ˆæ¯10ç§’ï¼‰
- æŒä»“å˜åŒ–

**ä¸ç°æœ‰ä»£ç é›†æˆ**ï¼š
- æ‰©å±•ç°æœ‰çš„`IStrategy`æ¥å£
- æ–°å¢åšå¸‚ç­–ç•¥ç±»å‹åˆ°`StrategyFactory`
- é›†æˆåˆ°ç­–ç•¥æ‰§è¡Œæµç¨‹

---

### 3.5 åŒå‘æŒä»“ç®¡ç†

**ä½ç½®**ï¼š`quantflow-trading/src/main/java/com/quantflow/trading/account/position/`

**éœ€è¦åˆ›å»ºçš„æ–‡ä»¶**ï¼š
```
account/position/
â”œâ”€â”€ HedgePositionManager.java            # åŒå‘æŒä»“ç®¡ç†å™¨
â”œâ”€â”€ PositionSide.java                    # æŒä»“æ–¹å‘æšä¸¾
â”œâ”€â”€ NetPositionCalculator.java          # å‡€æŒä»“è®¡ç®—å™¨
â”œâ”€â”€ PositionRiskMonitor.java            # æŒä»“é£é™©ç›‘æ§
â””â”€â”€ AutoHedgeService.java               # è‡ªåŠ¨å¯¹å†²æœåŠ¡
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

1. **æŒä»“æ–¹å‘åˆ¤æ–­**
   - è®¡ç®—å‡€æŒä»“ï¼ˆå¤šå¤´ - ç©ºå¤´ï¼‰
   - åˆ¤æ–­æŒä»“æ–¹å‘ï¼ˆLONG/SHORT/NEUTRALï¼‰

2. **åŠ¨æ€å¼€å¹³ä»“ç­–ç•¥**
   - å‡€å¤šå¤´æ—¶ï¼šä¹°å•ä¼˜å…ˆå¹³å¤šï¼Œå–å•å¼€ç©º
   - å‡€ç©ºå¤´æ—¶ï¼šå–å•ä¼˜å…ˆå¹³ç©ºï¼Œä¹°å•å¼€å¤š
   - ä¸­æ€§æ—¶ï¼šæ­£å¸¸åŒå‘åšå¸‚

3. **åˆ†çº§æ§åˆ¶**
   - 0-30%ï¼šæ­£å¸¸åšå¸‚
   - 30-50%ï¼šéƒ¨åˆ†å¹³ä»“
   - 50-70%ï¼šä¼˜å…ˆå¹³ä»“
   - 70-90%ï¼šå¼ºåˆ¶å¹³ä»“
   - >90%ï¼šç´§æ€¥å¤„ç†

4. **ä¿è¯é‡‘ç›‘æ§**
   - å®æ—¶è®¡ç®—å¯ç”¨ä¿è¯é‡‘
   - åˆ†çº§é¢„è­¦ï¼ˆ60%/75%/90%ï¼‰
   - è‡ªåŠ¨å‡ä»“æœºåˆ¶

**ä¸ç°æœ‰ä»£ç é›†æˆ**ï¼š
- æ‰©å±•ç°æœ‰çš„`PositionService.java`
- é›†æˆåˆ°è®¢å•ç”Ÿæˆé€»è¾‘
- é›†æˆåˆ°é£æ§ç³»ç»Ÿ

---

### 3.6 åŠ¨æ€é…ç½®ç®¡ç†ç³»ç»Ÿ

**ä½ç½®**ï¼š`quantflow-trading/src/main/java/com/quantflow/trading/config/`

**éœ€è¦åˆ›å»ºçš„æ–‡ä»¶**ï¼š
```
config/
â”œâ”€â”€ ConfigService.java                   # é…ç½®æœåŠ¡
â”œâ”€â”€ ConfigUpdateService.java            # é…ç½®æ›´æ–°æœåŠ¡
â”œâ”€â”€ ConfigChangeListener.java           # é…ç½®å˜æ›´ç›‘å¬å™¨
â”œâ”€â”€ ConfigValidator.java                # é…ç½®æ ¡éªŒå™¨
â”œâ”€â”€ ConfigRollbackService.java          # é…ç½®å›æ»šæœåŠ¡
â””â”€â”€ ConfigTemplateService.java          # é…ç½®æ¨¡æ¿æœåŠ¡
```

**æ•°æ®åº“è¡¨è®¾è®¡**ï¼š
```sql
-- ç³»ç»Ÿé…ç½®è¡¨
CREATE TABLE system_config (
    id BIGINT PRIMARY KEY,
    config_key VARCHAR(128) UNIQUE,
    config_value TEXT,
    value_type VARCHAR(32),
    category VARCHAR(64),
    description TEXT,
    min_value TEXT,
    max_value TEXT,
    default_value TEXT,
    is_enabled BOOLEAN,
    require_restart BOOLEAN,
    validation_rule TEXT,
    version INTEGER,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

-- é…ç½®å†å²è¡¨
CREATE TABLE config_history (
    id BIGINT PRIMARY KEY,
    config_key VARCHAR(128),
    old_value TEXT,
    new_value TEXT,
    change_reason TEXT,
    changed_by VARCHAR(64),
    changed_at TIMESTAMP,
    change_type VARCHAR(32),
    version INTEGER
);

-- ç­–ç•¥é…ç½®è¡¨
CREATE TABLE strategy_config (
    id BIGINT PRIMARY KEY,
    strategy_id VARCHAR(64) UNIQUE,
    strategy_name VARCHAR(128),
    strategy_type VARCHAR(64),
    symbol VARCHAR(32),
    exchange VARCHAR(32),
    is_active BOOLEAN,
    config_json JSONB,
    version INTEGER,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. **ä¸‰çº§ç¼“å­˜**ï¼šæœ¬åœ°ç¼“å­˜ â†’ Redis â†’ æ•°æ®åº“
2. **çƒ­æ›´æ–°**ï¼šé…ç½®å˜æ›´æ— éœ€é‡å¯
3. **å˜æ›´é€šçŸ¥**ï¼šRedis Pub/Subé€šçŸ¥æ‰€æœ‰èŠ‚ç‚¹
4. **é…ç½®æ ¡éªŒ**ï¼šç±»å‹ã€èŒƒå›´ã€æ­£åˆ™æ ¡éªŒ
5. **ç‰ˆæœ¬ç®¡ç†**ï¼šæ”¯æŒé…ç½®å›æ»š

**ä¸ç°æœ‰ä»£ç é›†æˆ**ï¼š
- æ›¿æ¢ç¡¬ç¼–ç çš„é…ç½®å‚æ•°
- ç­–ç•¥å‚æ•°ä»é…ç½®ç³»ç»Ÿè¯»å–
- æ”¯æŒè¿è¡Œæ—¶è°ƒæ•´ç­–ç•¥å‚æ•°

---

## 4. æ•°æ®åº“è®¾è®¡å˜æ›´

### 4.1 æ–°å¢è¡¨ç»“æ„

**è®¢å•è¡¨æ‰©å±•**ï¼ˆéœ€è¦ä¿®æ”¹`orders`è¡¨ï¼‰ï¼š
```sql
ALTER TABLE orders ADD COLUMN position_side VARCHAR(16) COMMENT 'æŒä»“æ–¹å‘';
ALTER TABLE orders ADD COLUMN reduce_only BOOLEAN COMMENT 'æ˜¯å¦åªå‡ä»“';
ALTER TABLE orders ADD COLUMN price_level INTEGER COMMENT 'ä»·æ ¼æ¡£ä½';
ALTER TABLE orders ADD COLUMN remaining_qty DECIMAL(20,8) COMMENT 'å‰©ä½™æ•°é‡';
ALTER TABLE orders ADD COLUMN client_order_id VARCHAR(64) COMMENT 'å®¢æˆ·ç«¯è®¢å•ID';
```

**æ–°å¢è®¢å•åˆ·æ–°æ—¥å¿—è¡¨**ï¼š
```sql
CREATE TABLE order_refresh_log (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    timestamp TIMESTAMP,
    symbol VARCHAR(32),
    trigger_type VARCHAR(32),
    refresh_strategy VARCHAR(32),
    orders_before INT,
    orders_cancelled INT,
    orders_placed INT,
    orders_kept INT,
    api_calls INT,
    duration_ms INT,
    max_deviation DECIMAL(10,6),
    avg_deviation DECIMAL(10,6),
    success BOOLEAN,
    error_message TEXT,
    INDEX idx_refresh_time (timestamp DESC),
    INDEX idx_refresh_symbol (symbol, timestamp DESC)
);
```

**æ–°å¢ä»·æ ¼åç¦»ç›‘æ§è¡¨**ï¼š
```sql
CREATE TABLE price_deviation_log (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    timestamp TIMESTAMP,
    symbol VARCHAR(32),
    order_id VARCHAR(64),
    order_level INT,
    order_price DECIMAL(20,8),
    ref_price DECIMAL(20,8),
    deviation DECIMAL(10,6),
    side VARCHAR(8),
    action_taken VARCHAR(32),
    is_arbitrage_risk BOOLEAN,
    INDEX idx_deviation_time (timestamp DESC),
    INDEX idx_deviation_symbol (symbol, timestamp DESC)
);
```

### 4.2 æŒä»“è¡¨æ‰©å±•

**éœ€è¦ä¿®æ”¹`positions`è¡¨**ï¼ˆå¦‚æœå½“å‰ä¸æ”¯æŒåŒå‘æŒä»“ï¼‰ï¼š
```sql
ALTER TABLE positions ADD COLUMN position_side VARCHAR(16) COMMENT 'æŒä»“æ–¹å‘(LONG/SHORT)';
ALTER TABLE positions ADD COLUMN unrealized_pnl DECIMAL(20,8) COMMENT 'æœªå®ç°ç›ˆäº';
ALTER TABLE positions ADD COLUMN entry_price DECIMAL(20,8) COMMENT 'å¼€ä»“å‡ä»·';
ALTER TABLE positions ADD COLUMN margin_used DECIMAL(20,8) COMMENT 'å ç”¨ä¿è¯é‡‘';
```

---

## 5. å‰ç«¯ç•Œé¢æ‰©å±•

### 5.1 åšå¸‚ç­–ç•¥ç®¡ç†ç•Œé¢

**ä½ç½®**ï¼š`ruoyi-ui/src/views/trading/marketmaking/`

**éœ€è¦åˆ›å»ºçš„é¡µé¢**ï¼š
```
marketmaking/
â”œâ”€â”€ index.vue                    # åšå¸‚ç­–ç•¥åˆ—è¡¨
â”œâ”€â”€ create.vue                    # åˆ›å»ºåšå¸‚ç­–ç•¥
â”œâ”€â”€ edit.vue                      # ç¼–è¾‘åšå¸‚ç­–ç•¥
â”œâ”€â”€ monitor.vue                   # åšå¸‚ç­–ç•¥ç›‘æ§
â””â”€â”€ config.vue                    # ç­–ç•¥é…ç½®ç®¡ç†
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. ç­–ç•¥åˆ›å»º/ç¼–è¾‘
   - é€‰æ‹©å‚è€ƒäº¤æ˜“æ‰€å’Œç›®æ ‡äº¤æ˜“æ‰€
   - é…ç½®ä»·æ ¼è°ƒæ•´ã€æ•°é‡æ¯”ä¾‹
   - è®¾ç½®ä¸¥æ ¼è·Ÿéšæ¡£ä½
   - é…ç½®é£é™©å‚æ•°

2. å®æ—¶ç›‘æ§
   - è®¢å•çŠ¶æ€å±•ç¤º
   - æŒä»“æƒ…å†µå±•ç¤º
   - ç›ˆäºç»Ÿè®¡
   - è®¢å•åˆ·æ–°æ•ˆç‡

3. é…ç½®ç®¡ç†
   - åŠ¨æ€è°ƒæ•´ç­–ç•¥å‚æ•°
   - æŸ¥çœ‹é…ç½®å†å²
   - é…ç½®å›æ»š

### 5.2 é…ç½®ç®¡ç†ç•Œé¢

**ä½ç½®**ï¼š`ruoyi-ui/src/views/system/config/`

**éœ€è¦åˆ›å»ºçš„é¡µé¢**ï¼š
```
config/
â”œâ”€â”€ system.vue                   # ç³»ç»Ÿé…ç½®ç®¡ç†
â”œâ”€â”€ strategy.vue                 # ç­–ç•¥é…ç½®ç®¡ç†
â”œâ”€â”€ history.vue                  # é…ç½®å†å²
â””â”€â”€ template.vue                 # é…ç½®æ¨¡æ¿
```

---

## 6. APIæ¥å£æ‰©å±•

### 6.1 åšå¸‚ç­–ç•¥API

**ä½ç½®**ï¼š`quantflow-trading/src/main/java/com/quantflow/trading/strategy/marketmaking/controller/`

**éœ€è¦åˆ›å»ºçš„æ¥å£**ï¼š
```java
@RestController
@RequestMapping("/api/marketmaking")
public class MarketMakingController {
    
    // åˆ›å»ºåšå¸‚ç­–ç•¥
    @PostMapping("/strategy")
    public Result createStrategy(@RequestBody MarketMakingStrategyDTO dto);
    
    // å¯åŠ¨/åœæ­¢ç­–ç•¥
    @PostMapping("/strategy/{id}/toggle")
    public Result toggleStrategy(@PathVariable Long id);
    
    // è·å–ç­–ç•¥çŠ¶æ€
    @GetMapping("/strategy/{id}/status")
    public Result getStrategyStatus(@PathVariable Long id);
    
    // è·å–æ´»è·ƒè®¢å•
    @GetMapping("/strategy/{id}/orders")
    public Result getActiveOrders(@PathVariable Long id);
    
    // æ‰‹åŠ¨åˆ·æ–°è®¢å•
    @PostMapping("/strategy/{id}/refresh")
    public Result refreshOrders(@PathVariable Long id);
}
```

### 6.2 é…ç½®ç®¡ç†API

**ä½ç½®**ï¼š`quantflow-trading/src/main/java/com/quantflow/trading/config/controller/`

**éœ€è¦åˆ›å»ºçš„æ¥å£**ï¼š
```java
@RestController
@RequestMapping("/api/config")
public class ConfigController {
    
    // æŸ¥è¯¢é…ç½®
    @GetMapping("/{key}")
    public Result getConfig(@PathVariable String key);
    
    // æ›´æ–°é…ç½®
    @PutMapping("/{key}")
    public Result updateConfig(@PathVariable String key, @RequestBody ConfigUpdateRequest request);
    
    // æŸ¥è¯¢é…ç½®å†å²
    @GetMapping("/{key}/history")
    public Result getConfigHistory(@PathVariable String key);
    
    // å›æ»šé…ç½®
    @PostMapping("/{key}/rollback")
    public Result rollbackConfig(@PathVariable String key, @RequestParam Integer version);
}
```

---

## 7. å®ç°æ­¥éª¤å»ºè®®

### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¶æ„ï¼ˆ2-3å‘¨ï¼‰

**Week 1**ï¼š
1. âœ… å®ç°`LocalDataManager`ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨
2. âœ… å®ç°`TimestampedData`æ•°æ®å®¹å™¨
3. âœ… å®ç°æ•°æ®ä¸€è‡´æ€§æ ¡éªŒå™¨

**Week 2**ï¼š
1. âœ… æ‰©å±•WebSocketæ¨é€ï¼ˆè®¢å•ã€æŒä»“ã€ä½™é¢ï¼‰
2. âœ… å®ç°WebSocketå¥åº·ç›‘æ§
3. âœ… é›†æˆåˆ°`LocalDataManager`

**Week 3**ï¼š
1. âœ… å®ç°æœ¬åœ°ç›˜å£ç»´æŠ¤æœºåˆ¶
2. âœ… å®ç°ç›˜å£WebSocketè®¢é˜…
3. âœ… å®ç°ç›˜å£åˆå§‹åŒ–æµç¨‹

### é˜¶æ®µäºŒï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆ3-4å‘¨ï¼‰

**Week 4-5**ï¼š
1. âœ… å®ç°åšå¸‚ç­–ç•¥å¼•æ“åŸºç±»
2. âœ… å®ç°ç›˜å£é•œåƒç­–ç•¥
3. âœ… å®ç°è®¢å•åˆ·æ–°æœåŠ¡

**Week 6**ï¼š
1. âœ… å®ç°æ™ºèƒ½è®¢å•åˆ·æ–°æœºåˆ¶
2. âœ… å®ç°é€‰æ‹©æ€§æ’¤å•é€»è¾‘
3. âœ… å®ç°è¡¥å•é€»è¾‘

**Week 7**ï¼š
1. âœ… å®ç°åŒå‘æŒä»“ç®¡ç†
2. âœ… å®ç°åŠ¨æ€å¼€å¹³ä»“ç­–ç•¥
3. âœ… å®ç°ä¿è¯é‡‘ç›‘æ§

### é˜¶æ®µä¸‰ï¼šå¢å¼ºåŠŸèƒ½ï¼ˆ2-3å‘¨ï¼‰

**Week 8-9**ï¼š
1. âœ… å®ç°åŠ¨æ€é…ç½®ç®¡ç†ç³»ç»Ÿ
2. âœ… å®ç°é…ç½®çƒ­æ›´æ–°æœºåˆ¶
3. âœ… å®ç°é…ç½®å˜æ›´é€šçŸ¥

**Week 10**ï¼š
1. âœ… å®ç°åˆ†å±‚åˆ·æ–°ç­–ç•¥
2. âœ… å®ç°å¥—åˆ©é˜²æŠ¤
3. âœ… å®Œå–„ç›‘æ§å’Œæ—¥å¿—

### é˜¶æ®µå››ï¼šå‰ç«¯å’Œæµ‹è¯•ï¼ˆ2å‘¨ï¼‰

**Week 11**ï¼š
1. âœ… å®ç°åšå¸‚ç­–ç•¥ç®¡ç†ç•Œé¢
2. âœ… å®ç°é…ç½®ç®¡ç†ç•Œé¢
3. âœ… å®ç°å®æ—¶ç›‘æ§ç•Œé¢

**Week 12**ï¼š
1. âœ… é›†æˆæµ‹è¯•
2. âœ… æ€§èƒ½æµ‹è¯•
3. âœ… æ–‡æ¡£ç¼–å†™

---

## 8. å…³é”®æŠ€æœ¯éš¾ç‚¹

### 8.1 WebSocketè¿æ¥ç®¡ç†

**éš¾ç‚¹**ï¼š
- å¤šäº¤æ˜“æ‰€WebSocketè¿æ¥
- è‡ªåŠ¨é‡è¿æœºåˆ¶
- å¿ƒè·³æ£€æµ‹
- æ¶ˆæ¯å»é‡

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨Nettyæˆ–OkHttp WebSocket
- å®ç°æŒ‡æ•°é€€é¿é‡è¿
- å®šæœŸping/pongæ£€æµ‹
- ä½¿ç”¨åºåˆ—å·å»é‡

### 8.2 æ•°æ®ä¸€è‡´æ€§ä¿è¯

**éš¾ç‚¹**ï¼š
- WebSocketæ•°æ®å¯èƒ½ä¸¢å¤±
- REST APIæ•°æ®å¯èƒ½å»¶è¿Ÿ
- å¤šèŠ‚ç‚¹æ•°æ®åŒæ­¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å®šæœŸæ•°æ®æ ¡éªŒï¼ˆæ¯5åˆ†é’Ÿï¼‰
- ä½¿ç”¨ç‰ˆæœ¬å·/åºåˆ—å·
- Redis Pub/SubåŒæ­¥
- æœ€ç»ˆä¸€è‡´æ€§æ¨¡å‹

### 8.3 è®¢å•åˆ·æ–°æ€§èƒ½

**éš¾ç‚¹**ï¼š
- 100msåˆ·æ–°é¢‘ç‡è¦æ±‚
- APIé™æµé™åˆ¶
- è®¢å•çŠ¶æ€åŒæ­¥å»¶è¿Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æœ¬åœ°ç›˜å£ç¼“å­˜ï¼ˆ<0.1msæŸ¥è¯¢ï¼‰
- æ™ºèƒ½å¢é‡åˆ·æ–°ï¼ˆå‡å°‘80% APIè°ƒç”¨ï¼‰
- WebSocketå®æ—¶æ¨é€ï¼ˆ<100mså»¶è¿Ÿï¼‰
- æ‰¹é‡æ“ä½œä¼˜åŒ–

### 8.4 åŒå‘æŒä»“èµ„é‡‘ç®¡ç†

**éš¾ç‚¹**ï¼š
- ä¿è¯é‡‘æŒç»­å ç”¨
- å•å‘æˆäº¤å¯¼è‡´æŒä»“å¤±è¡¡
- èµ„é‡‘ä¸è¶³æ— æ³•ç»§ç»­åšå¸‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åŠ¨æ€å¼€å¹³ä»“ç­–ç•¥
- åˆ†çº§æ§åˆ¶æœºåˆ¶
- ä»·æ ¼æ¿€åŠ±æœºåˆ¶
- è‡ªåŠ¨å¯¹å†²æœºåˆ¶

---

## 9. é£é™©ä¸æ³¨æ„äº‹é¡¹

### 9.1 æŠ€æœ¯é£é™©

1. **WebSocketç¨³å®šæ€§**
   - é£é™©ï¼šè¿æ¥æ–­å¼€å¯¼è‡´æ•°æ®ä¸¢å¤±
   - ç¼“è§£ï¼šè‡ªåŠ¨é‡è¿ + RESTé™çº§

2. **APIé™æµ**
   - é£é™©ï¼šé¢‘ç¹è°ƒç”¨è§¦å‘é™æµ
   - ç¼“è§£ï¼šæ™ºèƒ½åˆ·æ–° + æ‰¹é‡æ“ä½œ

3. **æ•°æ®å»¶è¿Ÿ**
   - é£é™©ï¼šæ•°æ®å»¶è¿Ÿå¯¼è‡´å†³ç­–é”™è¯¯
   - ç¼“è§£ï¼šæœ¬åœ°ç¼“å­˜ + å®æ—¶æ¨é€

### 9.2 ä¸šåŠ¡é£é™©

1. **å¥—åˆ©é£é™©**
   - é£é™©ï¼šä»·æ ¼åç¦»è¢«å¥—åˆ©
   - ç¼“è§£ï¼šä¸¥æ ¼è·Ÿéš + å¥—åˆ©é˜²æŠ¤

2. **èµ„é‡‘é£é™©**
   - é£é™©ï¼šä¿è¯é‡‘è€—å°½
   - ç¼“è§£ï¼šåˆ†çº§æ§åˆ¶ + è‡ªåŠ¨å¯¹å†²

3. **ç­–ç•¥é£é™©**
   - é£é™©ï¼šç­–ç•¥å‚æ•°ä¸å½“å¯¼è‡´äºæŸ
   - ç¼“è§£ï¼šé£æ§æ£€æŸ¥ + åŠ¨æ€è°ƒæ•´

### 9.3 å®æ–½å»ºè®®

1. **åˆ†é˜¶æ®µå®æ–½**
   - å…ˆå®ç°åŸºç¡€åŠŸèƒ½
   - é€æ­¥å¢åŠ é«˜çº§åŠŸèƒ½
   - å……åˆ†æµ‹è¯•åå†ä¸Šçº¿

2. **ç°åº¦å‘å¸ƒ**
   - å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
   - å°è§„æ¨¡å®ç›˜æµ‹è¯•
   - é€æ­¥æ‰©å¤§è§„æ¨¡

3. **ç›‘æ§å‘Šè­¦**
   - å®Œå–„çš„ç›‘æ§ä½“ç³»
   - åŠæ—¶å‘Šè­¦æœºåˆ¶
   - å¿«é€Ÿå“åº”èƒ½åŠ›

---

## 10. æ€»ç»“

### 10.1 æ ¸å¿ƒä»·å€¼

å®ç°åšå¸‚ç³»ç»Ÿåï¼Œç³»ç»Ÿå°†å…·å¤‡ï¼š
- âœ… **é«˜æ€§èƒ½**ï¼šè®¢å•å»¶è¿Ÿ<1msï¼Œæ”¯æŒé«˜é¢‘äº¤æ˜“
- âœ… **æ™ºèƒ½åŒ–**ï¼šè‡ªåŠ¨è®¢å•åˆ·æ–°ï¼Œå‡å°‘80% APIè°ƒç”¨
- âœ… **é«˜å¯ç”¨**ï¼šWebSocket + RESTé™çº§ï¼Œ99.9%å¯ç”¨æ€§
- âœ… **é£é™©å¯æ§**ï¼šå®Œå–„çš„é£æ§æœºåˆ¶ï¼ŒåŒå‘æŒä»“ç®¡ç†
- âœ… **çµæ´»é…ç½®**ï¼šåŠ¨æ€é…ç½®ç®¡ç†ï¼Œæ— éœ€é‡å¯

### 10.2 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**ï¼š
   - å®ç°`LocalDataManager`ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨
   - æ‰©å±•WebSocketæ•°æ®æ¨é€

2. **å¹¶è¡Œå¼€å‘**ï¼š
   - æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡
   - å‰ç«¯ç•Œé¢è®¾è®¡

3. **æµ‹è¯•éªŒè¯**ï¼š
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - æ€§èƒ½æµ‹è¯•

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**ï¼š2025-11-07  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**å»ºè®®å®¡æŸ¥**ï¼šæŠ€æœ¯è´Ÿè´£äººã€æ¶æ„å¸ˆã€äº§å“ç»ç†

